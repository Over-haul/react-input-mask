"use strict";function t(t){return t&&"object"==typeof t&&"default"in t?t.default:t}var e=require("react"),n=t(e),i=t(require("invariant"));function r(){return(r=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)({}).hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t}).apply(null,arguments)}function a(t,e){if(null==t)return{};var n={};for(var i in t)if({}.hasOwnProperty.call(t,i)){if(-1!==e.indexOf(i))continue;n[i]=t[i]}return n}function o(t,e){return(o=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return function(t,e){for(var n=Object.getOwnPropertyNames(e),i=0;i<n.length;i++){var r=n[i],a=Object.getOwnPropertyDescriptor(e,r);a&&a.configurable&&void 0===t[r]&&Object.defineProperty(t,r,a)}}(t,e),t})(t,e)}function u(t){return requestAnimationFrame(t)}function l(t){cancelAnimationFrame(t)}function s(t){var e=t.ownerDocument;return e.hasFocus()&&e.activeElement===t}function c(t){return null==t?void 0:t.ownerDocument}function f(t){var e=function(t){var e;return null==(e=c(t))?void 0:e.defaultView}(t);return!!e&&t instanceof e.HTMLElement}function h(t){return"function"==typeof t}function g(t){return e.useCallback((function(){var e=t.current,n="undefined"!=typeof window&&f(e);if(!e||!n)return null;if("INPUT"!==e.nodeName&&(e=e.querySelector("input")),!e)throw new Error("react-input-mask: inputComponent doesn't contain input node");return e}),[t])}function v(t,n){var i,r,a,o,c=e.useRef({start:null,end:null}),f=g(t),h=e.useCallback((function(){return function(t){var e=t.selectionStart,n=t.selectionEnd;return{start:e,end:n,length:n-e}}(f())}),[f]),v=e.useCallback((function(){return c.current}),[]),d=e.useCallback((function(t){var e=f();e&&s(e)&&(!function(t,e,n){void 0===n&&(n=e),t.setSelectionRange(e,n)}(e,t.start,t.end),c.current=h())}),[f,h]),p=e.useCallback((function(){c.current=h()}),[h]),m=(i=p,r=e.useRef(null),a=e.useCallback((function(){null===r.current&&function t(){i(),r.current=u(t)}()}),[i]),o=e.useCallback((function(){l(r.current),r.current=null}),[]),e.useEffect((function(){r.current&&(o(),a())}),[a,o]),e.useEffect(l,[]),[a,o]),P=m[0],b=m[1];return e.useLayoutEffect((function(){if(n){var t=f();return t.addEventListener("focus",P),t.addEventListener("blur",b),s(t)&&P(),function(){t.removeEventListener("focus",P),t.removeEventListener("blur",b),b()}}})),{getSelection:h,getLastSelection:v,setSelection:d}}function d(t,n){var i=e.useRef(),r=v(i,n),a=r.getSelection,o=r.getLastSelection,u=r.setSelection,l=function(t,n){var i=g(t),r=e.useRef(n);return{getValue:e.useCallback((function(){return i().value}),[i]),getLastValue:e.useCallback((function(){return r.current}),[]),setValue:e.useCallback((function(t){r.current=t;var e=i();e&&(e.value=t)}),[i])}}(i,t),s=l.getValue,c=l.getLastValue,f=l.setValue;return{inputRef:i,getInputState:function(){return{value:s(),selection:a()}},getLastInputState:function(){return{value:c(),selection:o()}},setInputState:function(t){var e=t.value,n=t.selection;f(e),u(n)}}}require("warning");var p=["disabled","onBlur","onChange","onFocus","onMouseDown","readOnly","value"],m={9:/[0-9]/,a:/[A-Za-z]/,"*":/[A-Za-z0-9]/};var P=function(t){var e=this;this.isCharacterAllowedAtPosition=function(t,n){var i=e.maskOptions.maskPlaceholder;return!!e.isCharacterFillingPosition(t,n)||!!i&&i[n]===t},this.isCharacterFillingPosition=function(t,n){var i=e.maskOptions.mask;if(!t||n>=i.length)return!1;if(!e.isPositionEditable(n))return i[n]===t;var r=i[n];return new RegExp(r).test(t)},this.isPositionEditable=function(t){var n=e.maskOptions,i=n.mask,r=n.permanents;return t<i.length&&-1===r.indexOf(t)},this.isValueEmpty=function(t){return t.split("").every((function(t,n){return!e.isPositionEditable(n)||!e.isCharacterFillingPosition(t,n)}))},this.isValueFilled=function(t){return e.getFilledLength(t)===e.maskOptions.lastEditablePosition+1},this.getDefaultSelectionForValue=function(t){var n=e.getFilledLength(t),i=e.getRightEditablePosition(n);return{start:i,end:i}},this.getFilledLength=function(t){return function(t,e){for(var n=t.length-1;n>=0;n--){if(e(t[n],n))return n}return-1}(t.split(""),(function(t,n){return e.isPositionEditable(n)&&e.isCharacterFillingPosition(t,n)}))+1},this.getStringFillingLengthAtPosition=function(t,n){return t.split("").reduce((function(t,n){return e.insertCharacterAtPosition(t,n,t.length)}),function(t,e){void 0===e&&(e=1);for(var n="",i=0;i<e;i++)n+=t;return n}(" ",n)).length-n},this.getLeftEditablePosition=function(t){for(var n=t;n>=0;n--)if(e.isPositionEditable(n))return n;return null},this.getRightEditablePosition=function(t){for(var n=e.maskOptions.mask,i=t;i<n.length;i++)if(e.isPositionEditable(i))return i;return null},this.formatValue=function(t){var n=e.maskOptions,i=n.maskPlaceholder,r=n.mask;if(!i){for(t=e.insertStringAtPosition("",t,0);t.length<r.length&&!e.isPositionEditable(t.length);)t+=r[t.length];return t}return e.insertStringAtPosition(i,t,0)},this.clearRange=function(t,n,i){if(!i)return t;var r=n+i,a=e.maskOptions,o=a.maskPlaceholder,u=a.mask,l=t.split("").map((function(t,i){var a=e.isPositionEditable(i);return!o&&i>=r&&!a?"":i<n||i>=r?t:a?o?o[i]:"":u[i]})).join("");return e.formatValue(l)},this.insertCharacterAtPosition=function(t,n,i){var r=e.maskOptions,a=r.mask,o=r.maskPlaceholder;if(i>=a.length)return t;var u=e.isCharacterAllowedAtPosition(n,i),l=e.isPositionEditable(i),s=e.getRightEditablePosition(i),c=o&&s?n===o[s]:null,f=t.slice(0,i);!u&&l||(t=f+(u?n:a[i]));return u||l||c||(t=e.insertCharacterAtPosition(t,n,i+1)),t},this.insertStringAtPosition=function(t,n,i){var r=e.maskOptions,a=r.mask,o=r.maskPlaceholder;if(!n||i>=a.length)return t;var u=n.split(""),l=e.isValueFilled(t)||!!o,s=t.slice(i);if(t=u.reduce((function(t,n){return e.insertCharacterAtPosition(t,n,t.length)}),t.slice(0,i)),l)t+=s.slice(t.length-i);else if(e.isValueFilled(t))t+=a.slice(t.length).join("");else{t=s.split("").filter((function(t,n){return e.isPositionEditable(i+n)})).reduce((function(t,n){var i=e.getRightEditablePosition(t.length);return null===i?t:(e.isPositionEditable(t.length)||(t+=a.slice(t.length,i).join("")),e.insertCharacterAtPosition(t,n,t.length))}),t)}return t},this.processChange=function(t,n){var i=e.maskOptions,r=i.mask,a=i.prefix,o=i.lastEditablePosition,u=t.value,l=t.selection,s=n.value,c=n.selection,f=u,h="",g=0,v=0,d=Math.min(c.start,l.start);if(l.end>c.start?(h=f.slice(c.start,l.end),v=(g=e.getStringFillingLengthAtPosition(h,d))?c.length:0):f.length<s.length&&(v=s.length-f.length),f=s,v){if(1===v&&!c.length)d=c.start===l.start?e.getRightEditablePosition(l.start):e.getLeftEditablePosition(l.start);f=e.clearRange(f,d,v)}return f=e.insertStringAtPosition(f,h,d),(d+=g)>=r.length?d=r.length:d<a.length&&!g?d=a.length:d>=a.length&&d<o&&g&&(d=e.getRightEditablePosition(d)),{value:f=e.formatValue(f),enteredString:h,selection:{start:d,end:d}}},this.maskOptions=function(t){var e=t.mask,n=t.maskPlaceholder,i=[];if(!e)return{maskPlaceholder:null,mask:null,prefix:null,lastEditablePosition:null,permanents:[]};if("string"==typeof e){var r=!1,a="";e.split("").forEach((function(t){r||"\\"!==t?(!r&&m[t]||i.push(a.length),a+=t,r=!1):r=!0})),e=a.split("").map((function(t,e){return-1===i.indexOf(e)?m[t]:t}))}else e.forEach((function(t,e){"string"==typeof t&&i.push(e)}));n&&(n=1===n.length?e.map((function(t,e){return-1!==i.indexOf(e)?t:n})):n.split(""),i.forEach((function(t){n[t]=e[t]})),n=n.join(""));for(var o=i.filter((function(t,e){return t===e})).map((function(t){return e[t]})).join(""),u=e.length-1;-1!==i.indexOf(u);)u--;return{maskPlaceholder:n,prefix:o,mask:e,lastEditablePosition:u,permanents:i}}(t)},b=["children"],k=function(t){function e(){return t.apply(this,arguments)||this}var i,r;return r=t,(i=e).prototype=Object.create(r.prototype),i.prototype.constructor=i,o(i,r),e.prototype.render=function(){var t=this.props,e=t.children,i=a(t,b);return n.cloneElement(e,i)},e}(n.Component),E=["alwaysShowMask","children","mask","maskPlaceholder","beforeMaskedStateChange","inputRef"],S=e.forwardRef((function(t,o){var l=t.alwaysShowMask,f=void 0!==l&&l,v=t.children,m=t.mask,b=t.maskPlaceholder,S=void 0===b?"_":b,C=t.beforeMaskedStateChange,y=t.inputRef,O=a(t,E);!function(t){var e=t.mask,n=t.maskPlaceholder;e&&n&&1!==n.length&&n.length!==e.length&&i(!1)}(t);var w,V,F=new P({mask:m,maskPlaceholder:S}),L=!!m,R=!O.disabled&&!O.readOnly,A=null!==t.value&&void 0!==t.value,j=(w=L,V=e.useRef(),e.useEffect((function(){V.current=w})),V.current),x=d(function(t){return""+t}((A?t.value:t.defaultValue)||""),L),M=x.inputRef,D=x.getInputState,I=x.setInputState,q=x.getLastInputState,B=g(M);if(L&&A){var N=B(),T=N&&s(N)||f||t.value?F.formatValue(t.value):t.value;C&&(T=C({nextState:{value:T,selection:{start:null,end:null}}}).value),I(r({},q(),{value:T}))}var z=q(),X=z.selection,Y=z.value;e.useLayoutEffect((function(){if(L){var t=s(B()),e=X,n=D(),i=r({},n);if(!A){var a=n.value,o=F.formatValue(a),u=F.isValueEmpty(o);!u||t||f?i.value=o:u&&!t&&(i.value="")}t&&!j?i.selection=F.getDefaultSelectionForValue(i.value):A&&t&&e&&null!==e.start&&null!==e.end&&(i.selection=e),C&&(i=C({currentState:n,nextState:i})),I(i)}}));var Z=r({},O,{onFocus:function(e){M.current=e.target;var n=D().value;if(L&&!F.isValueFilled(n)){var i=F.formatValue(n),r=F.getDefaultSelectionForValue(i),a={value:i,selection:r};C&&(i=(a=C({currentState:D(),nextState:a})).value,r=a.selection),I(a),i!==n&&t.onChange&&t.onChange(e),u((function(){I(q())}))}t.onFocus&&t.onFocus(e)},onBlur:function(e){var n=D().value,i=q().value;if(L&&!f&&F.isValueEmpty(i)){var r="",a={value:r,selection:{start:null,end:null}};C&&(r=(a=C({currentState:D(),nextState:a})).value),I(a),r!==n&&t.onChange&&t.onChange(e)}t.onBlur&&t.onBlur(e)},onChange:L&&R?function(e){var n=D(),i=q(),r=F.processChange(n,i);C&&(r=C({currentState:n,previousState:i,nextState:r})),I(r),t.onChange&&t.onChange(e)}:t.onChange,onMouseDown:L&&R?function(e){var n=B(),i=D().value,a=c(n);if(!s(n)&&!F.isValueFilled(i)){var o=e.clientX,u=e.clientY,l=(new Date).getTime(),f=function(t){if(a.removeEventListener("mouseup",f),s(n)){var e=Math.abs(t.clientX-o),i=Math.abs(t.clientY-u),c=Math.max(e,i),h=(new Date).getTime()-l;if(c<=10&&h<=200||c<=5&&h<=300){var g=q(),v=r({},g,{selection:F.getDefaultSelectionForValue(g.value)});I(v)}}};a.addEventListener("mouseup",f)}t.onMouseDown&&t.onMouseDown(e)}:t.onMouseDown,ref:function(t){M.current=y.current,h(o)?o(t):null!==o&&"object"==typeof o&&(o.current=t)},value:L&&A?Y:t.value});return v?(function(t,e){p.filter((function(n){return null!=e.props[n]&&e.props[n]!==t[n]})).length&&i(!1)}(t,v),n.createElement(k,Z,v)):n.createElement("input",r({},Z,{ref:function(t){M.current=t,h(o)?o(t):null!==o&&"object"==typeof o&&(o.current=t)}}))}));S.displayName="InputMask",module.exports=S;
